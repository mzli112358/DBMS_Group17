<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Gym Management System</title>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        main {
            flex: 1;
        }
        .footer {
            width: 100%;
            background-color: #f8f9fa;
            padding: 1rem 0;
            margin-top: auto;
        }
    </style>

    
    <style>
      /* 浮动按钮样式 */
      .chatbot-float-button {
          position: fixed;
          bottom: 24px;
          right: 24px;
          width: 60px;
          height: 60px;
          background-color: #1C64F2;
          border-radius: 50%;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 9998;
          transition: transform 0.2s ease;
      }
      
      .chatbot-float-button:hover {
          transform: scale(1.05);
      }
      
      .chatbot-float-button svg {
          width: 30px;
          height: 30px;
          fill: white;
      }
      
      /* 浮窗样式 */
      .chatbot-float-window {
          position: fixed;
          bottom: 96px;
          right: 24px;
          width: 24rem;
          height: 40rem;
          background-color: white;
          border-radius: 12px;
          box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
          z-index: 9999;
          overflow: hidden;
          display: none;
      }
      
      .chatbot-iframe {
          width: 100%;
          height: 100%;
          border: none;
      }
      
      /* 关闭按钮 */
      .chatbot-close-btn {
          position: absolute;
          top: 10px;
          right: 10px;
          width: 24px;
          height: 24px;
          background-color: rgba(0, 0, 0, 0.1);
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          z-index: 10000;
      }
      
      .chatbot-close-btn svg {
          width: 12px;
          height: 12px;
          fill: #333;
      }
    </style>

    {% if session.get('username') and request.path != url_for('gym_chat') %}
    <style>
      #dify-chatbot-bubble-button {
        background-color: #1C64F2 !important;
        background-image: url("{{ url_for('static', filename='images/Gymbase_logo.jpg') }}") !important;
        background-size: cover !important;
        background-position: center !important;
        width: 60px !important;
        height: 60px !important;
        border-radius: 50% !important;
      }
      #dify-chatbot-bubble-button::before,
      #dify-chatbot-bubble-button::after {
        display: none !important;
      }
      #dify-chatbot-bubble-button svg {
        display: none !important;
      }
      #dify-chatbot-bubble-window {
        width: 24rem !important;
        height: 40rem !important;
      }
    </style>
    {% endif %}
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light shadow-sm">
  <div class="container">
    <a class="navbar-brand" href="{{ url_for('index') }}">
        <i class="bi bi-dumbbell me-2"></i>Gym
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#ugymNav" aria-controls="ugymNav" aria-expanded="false" aria-label="Toggle nav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="ugymNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('courses') }}"><i class="bi bi-calendar3 me-1"></i>Courses</a></li>
        {% if session.get('username') %}
        <li class="nav-item"><a class="nav-link" href="{{ url_for('course_instances') }}"><i class="bi bi-arrow-repeat me-1"></i>Cycles</a></li>
        {% endif %}
        <li class="nav-item"><a class="nav-link" href="{{ url_for('products') }}"><i class="bi bi-shop me-1"></i>Shop</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('coaches') }}"><i class="bi bi-person-badge me-1"></i>Coaches</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('lost_and_found') }}"><i class="bi bi-search me-1"></i>Lost & Found</a></li>
      
        {% if session.get('role') == 'member' %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('my_purchase') }}"><i class="bi bi-bag me-1"></i>Orders</a></li>
        {% endif %}
      
        {% if session.get('role') == 'coach' %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('coach_schedule') }}"><i class="bi bi-calendar-check me-1"></i>Schedule</a></li>
        {% endif %}
      
        {% if session.get('role') == 'staff' or session.get('role') == 'admin' %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('dashboard') }}"><i class="bi bi-speedometer2 me-1"></i>Dashboard</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('branch_manage') }}"><i class="bi bi-building me-1"></i>Branches</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('admin_manage') }}"><i class="bi bi-people me-1"></i>Person</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('equipment_manage') }}"><i class="bi bi-tools me-1"></i>Equipment</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('course_template_manage') }}"><i class="bi bi-file-earmark-text me-1"></i>Templates</a></li>
        {% endif %}
      </ul>      
      <ul class="navbar-nav ms-auto">
        {% if session.get('username') %}
        <li class="nav-item d-flex align-items-center">
            <a href="{{ url_for('user_profile') }}" class="nav-link me-2">
                <i class="bi bi-person-circle me-1"></i>
                {{ session['last_name'] }}({{ session['role'] }})
            </a>
            <a class="btn btn-outline-danger btn-sm" href="{{ url_for('logout') }}">
                <i class="bi bi-box-arrow-right me-1"></i>Logout
            </a>
        </li>
        {% else %}
        <li class="nav-item">
            <a class="btn btn-outline-primary" href="{{ url_for('login') }}">
                <i class="bi bi-box-arrow-in-right me-1"></i>Login
            </a>
        </li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

<main class="container py-4">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
          {{ messages[0] }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endif %}
    {% endwith %}
    {% block body %}{% endblock %}
</main>

<footer class="footer">
  <div class="container text-center">
      <span class="text-muted">
          <p class="mb-1">Database Management Systems [Semester 2 of 2024-2025]</p>
          <p class="mb-0">&copy; 2025 Chenwen FAN (Tony), Yishuo ZHANG (Ocast), Shaopeng CHEN (Leonid), Mingzhe LI (Tetsu)</p>
          <a href="#" class="text-decoration-none">Feedback</a>
      </span>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // 表单验证
    function validateForm(form) {
        const inputs = form.querySelectorAll('input[required], select[required], textarea[required]');
        let isValid = true;

        inputs.forEach(input => {
            if (!input.value.trim()) {
                isValid = false;
                input.classList.add('is-invalid');
            } else {
                input.classList.remove('is-invalid');
            }
        });

        return isValid;
    }

    // 为所有表单添加验证
    document.addEventListener('DOMContentLoaded', function() {
        const forms = document.querySelectorAll('form');
        forms.forEach(form => {
            form.addEventListener('submit', function(e) {
                if (!validateForm(this)) {
                    e.preventDefault();
                }
            });
        });
    });

    // 自动隐藏警告消息
    document.addEventListener('DOMContentLoaded', function() {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
            setTimeout(() => {
                alert.classList.remove('show');
                setTimeout(() => alert.remove(), 150);
            }, 5000);
        });
    });
</script>





<!--
原来的ai
{% if session.get('username') and request.path != url_for('gym_chat') %}
<script>
  window.difyChatbotConfig = {
   token: 'yjrc6WiMwHdGBx1i',
   systemVariables: {
     // user_id: 'YOU CAN DEFINE USER ID HERE',
   },
  }
 </script>
 <script
  src="https://udify.app/embed.min.js"
  id="yjrc6WiMwHdGBx1i"
  defer>
 </script>
{% endif %}
-->
  <!-- 浮动按钮 -->
  <div class="chatbot-float-button" id="chatbotFloatButton">
    <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
        <path d="M798.239721 592.527035 798.239721 177.35943c0-35.273365-28.599362-63.871703-63.87068-63.871703L127.584282 113.487727c-35.273365 0-63.871703 28.598338-63.871703 63.871703l0 415.167604c0 35.273365 28.598338 63.871703 63.871703 63.871703l63.871703 0 0 159.678746 159.679769-159.678746 383.232265 0C769.639337 656.398738 798.238698 627.800399 798.239721 592.527035L798.239721 592.527035zM324.689429 592.527035l-69.362764 69.361741 0-69.361741L127.584282 592.527035 127.584282 177.35943 734.369042 177.35943l0 415.167604L324.689429 592.527035 324.689429 592.527035zM894.047788 209.295793l-63.871703 0 0 63.871703 63.871703 0 0 415.168628L766.304382 688.336124l0 69.360717-69.362764-69.360717L383.072117 688.336124l0 63.87068 287.423175 0 159.679769 159.679769L830.175061 752.20578l63.872726 0c35.272341 0 63.87068-28.598338 63.87068-63.87068L957.918467 273.167496C957.918467 237.894132 929.319106 209.295793 894.047788 209.295793L894.047788 209.295793z" fill="#ffffff"></path>
    </svg>
  </div>

  <!-- 浮窗 -->
  <div class="chatbot-float-window" id="chatbotFloatWindow">
    <iframe 
        class="chatbot-iframe" 
        src="http://115.190.13.176/chat/47KK3769cB9LJQGr?timestamp={{ g.timestamp }}"
        frameborder="0" 
        allow="microphone">
    </iframe>
  </div>

  <script>
    // 获取DOM元素
    const floatButton = document.getElementById('chatbotFloatButton');
    const floatWindow = document.getElementById('chatbotFloatWindow');
    const floatButtonIcon = floatButton.querySelector('svg'); // 获取按钮内的SVG

    // 初始状态：聊天图标
    let isChatOpen = false;

    // 点击浮动按钮切换浮窗显示/隐藏，并改变图标
    floatButton.addEventListener('click', function() {
        isChatOpen = !isChatOpen; // 切换状态
        
        if (isChatOpen) {
            floatWindow.style.display = 'block';
            // 切换为"X"关闭图标
            floatButtonIcon.innerHTML = '<path d="M603.216 512L918.56 827.344a32.24 32.24 0 0 1 0 45.6l-45.6 45.6a32.24 32.24 0 0 1-45.6 0L512 603.216 196.656 918.56a32.24 32.24 0 0 1-45.6 0L105.44 872.96a32.24 32.24 0 0 1 0-45.6L420.784 512 105.44 196.656a32.24 32.24 0 0 1 0-45.6l45.616-45.6a32.24 32.24 0 0 1 45.6 0L512 420.784 827.344 105.44a32.24 32.24 0 0 1 45.6 0l45.6 45.6a32.24 32.24 0 0 1 0 45.6L603.216 512z" p-id="3633" fill="#ffffff"></path>';
        } else {
            floatWindow.style.display = 'none';
            // 切换回聊天图标
            floatButtonIcon.innerHTML = '<path d="M798.239721 592.527035 798.239721 177.35943c0-35.273365-28.599362-63.871703-63.87068-63.871703L127.584282 113.487727c-35.273365 0-63.871703 28.598338-63.871703 63.871703l0 415.167604c0 35.273365 28.598338 63.871703 63.871703 63.871703l63.871703 0 0 159.678746 159.679769-159.678746 383.232265 0C769.639337 656.398738 798.238698 627.800399 798.239721 592.527035L798.239721 592.527035zM324.689429 592.527035l-69.362764 69.361741 0-69.361741L127.584282 592.527035 127.584282 177.35943 734.369042 177.35943l0 415.167604L324.689429 592.527035 324.689429 592.527035zM894.047788 209.295793l-63.871703 0 0 63.871703 63.871703 0 0 415.168628L766.304382 688.336124l0 69.360717-69.362764-69.360717L383.072117 688.336124l0 63.87068 287.423175 0 159.679769 159.679769L830.175061 752.20578l63.872726 0c35.272341 0 63.87068-28.598338 63.87068-63.87068L957.918467 273.167496C957.918467 237.894132 929.319106 209.295793 894.047788 209.295793L894.047788 209.295793z" fill="#ffffff"></path>';
        }
    });
    
    // 点击浮窗外部区域不关闭
    floatWindow.addEventListener('click', function(e) {
        e.stopPropagation();
    });
  </script>

  
</body>
</html>