{% extends 'base.html' %}
{% block body %}
<h3>Course List</h3>

<!-- 搜索表单 -->
<form method="post" class="d-flex mb-4">
    <input name="q" class="form-control w-25" placeholder="Keyword search" value="{{ q }}">
    <button class="btn btn-primary ms-2" type="submit">Search</button>
</form>

<!-- 展示课程卡片 -->
<div class="row">
  {% for c in courses %}
  <div class="col-md-4 mb-3">
    <div class="card h-100">
      
      <!-- 图片区域 -->
      <div class="image-container" style="height: 200px; overflow: hidden; display: flex; justify-content: center; align-items: center; background-color: #f8f9fa;">
        <img src="{{ url_for('static', filename='images/' ~ (c.img or 'default_course.jpg')) }}" 
             class="card-img-top img-fluid" 
             alt="{{ c.name }}"
             style="height: 100%; width: auto; object-fit: contain; max-width: 100%;">
      </div>
      
      <!-- 课程信息 -->
      <div class="card-body">
        <h5 class="card-title">{{ c.name }}</h5>
        <p class="mb-1">Coach: {{ c.coach_name or '' }}</p>
        <p class="mb-1">Schedule: {{ c.start_date }} to {{ c.end_date }}</p>
        <p class="mb-1">Time: {{ c.start_time }} ~ {{ c.end_time }}</p>
        <p class="mb-1">Hours: {{ c.hours }} | Location: {{ c.location }}</p>
        <p class="mb-1">Fee: ￥{{ c.fee }} | Requirement: {{ c.requirement }}</p>
        <p class="mb-1">Available slots: {{ c.remain }}</p>
        
        {% if session.get('role') == 'member' %}
          <!-- 普通报名按钮 -->
          <a href="{{ url_for('enroll_course', course_id=c.course_id) }}" class="btn btn-success btn-sm mt-1">Enroll</a>

          <!-- 自动生成模板并排课的按钮 -->
          <a href="{{ url_for('auto_generate_template', course_id=c.course_id) }}" class="btn btn-warning btn-sm mt-1">Auto Enroll (Cycle)</a>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}
