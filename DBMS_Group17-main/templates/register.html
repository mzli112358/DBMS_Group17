{% extends 'base.html' %}
{% block body %}

<h2 class="mb-4 text-center">Register an Account</h2>
<form method="post" class="w-50 mx-auto" id="regForm" autocomplete="off">
  <div class="mb-3">
    <label for="role">Role Selection</label>
    <select name="role" id="role" class="form-select" required>
      <option value="member">Member</option>
      <option value="coach">Coach</option>
      <option value="staff">Staff</option>
    </select>
  </div>
  <div class="row">
    <div class="mb-3 col">
      <label for="last_name">Last Name</label>
      <input name="last_name" type="text" id="last_name" class="form-control" required>
    </div>
    <div class="mb-3 col">
      <label for="first_name">First Name</label>
      <input name="first_name" type="text" id="first_name" class="form-control" required>
    </div>
  </div>
  <div class="mb-3">
    <label for="username">Username</label>
    <input name="username" type="text" id="username" class="form-control" maxlength="32" required>
  </div>
  <div class="row">
    <div class="mb-3 col">
      <label for="gender">Gender</label>
      <select name="gender" id="gender" class="form-select">
        <option value="">Please select</option>
        <option value="M">Male</option>
        <option value="F">Female</option>
        <option value="Other">Other</option>
      </select>
    </div>
    <div class="mb-3 col">
      <label for="birthday">Birthday</label>
      <input name="birthday" type="date" id="birthday" class="form-control" required>
    </div>
  </div>
  <div class="mb-3">
    <label for="phone">Phone Number</label>
    <input name="phone" type="text" id="phone" class="form-control" pattern="^1\d{10}$" required>
  </div>
  <div class="mb-3">
    <label for="id_number">ID Number</label>
    <input name="id_number" type="text" id="id_number" class="form-control" maxlength="18" pattern="^(\d{15}|\d{17}[\dX])$" required>
  </div>
  <div class="row">
    <div class="mb-3 col">
      <label for="password">Password</label>
      <input name="password" id="pw1" type="password" class="form-control" required>
    </div>
    <div class="mb-3 col">
      <label for="password2">Repeat Password</label>
      <input id="pw2" name="password2" type="password" class="form-control" required>
    </div>
  </div>
  <div class="mb-3">
    <label for="branch_id">Registration Branch</label>
    <select name="branch_id" id="branch_id" class="form-select" required>
      {% for b in branches %}
      <option value="{{ b.branch_id }}">{{ b.name }} [{{ b.city }}/{{ b.district }}]</option>
      {% endfor %}
    </select>
  </div>
  <div id="coach_fields" style="display:none;">
    <div class="mb-3">
      <label for="specialty">Coaching Specialty</label>
      <input name="specialty" type="text" id="specialty" class="form-control" placeholder="e.g., Fitness, Aerobics, Yoga, Swimming, etc.">
    </div>
    <div class="row">
      <div class="mb-3 col">
        <label for="qualification_no">Qualification Number</label>
        <input name="qualification_no" type="text" id="qualification_no" class="form-control">
      </div>
      <div class="mb-3 col">
        <label for="qualification_expiry">Qualification Expiry Date</label>
        <input name="qualification_expiry" type="date" id="qualification_expiry" class="form-control">
      </div>
    </div>
  </div>
  <div id="staff_fields" style="display:none;">
    <div class="mb-3">
      <label for="position">Position</label>
      <select name="position" id="position" class="form-select">
        <option value="">Please select a position</option>
        <option value="manager">Manager</option>
        <option value="frontdesk">Front Desk</option>
        <option value="warehouse">Warehouse</option>
        <option value="other">Other</option>
      </select>
    </div>
  </div>
  <div class="form-check mb-3">
    <input class="form-check-input" name="agreement" type="checkbox" id="agreement" required>
    <label class="form-check-label" for="agreement">
      I have read and agree to the <a href="#">User Privacy Policy</a>
    </label>
  </div>
  <button class="btn btn-success w-100" type="submit">Register Now</button>
  <div class="text-center mt-3">
    Already have an account? <a href="{{ url_for('login') }}">Log in</a>
  </div>
</form>
<script>
document.getElementById('role').addEventListener('change', e=>{
    let role = e.target.value;
    document.getElementById('coach_fields').style.display = (role=='coach' ? '' : 'none');
    document.getElementById('staff_fields').style.display = (role=='staff' ? '' : 'none');
});
document.getElementById('regForm').addEventListener('submit', function(e){
    let pw1 = document.getElementById('pw1').value;
    let pw2 = document.getElementById('pw2').value;
    if(pw1 !== pw2) {
        alert("Passwords do not match");
        e.preventDefault();
    }
});
</script>
{% endblock %}